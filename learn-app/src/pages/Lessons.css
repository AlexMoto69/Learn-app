/* add to `learn-app/src/pages/Lessons.css` */
:root {
  /* safe default for the lessons top-offset so CSS doesn't see it as undefined before JS runs */
  --app-header-height: var(--menu-h, 84px);
  /* subtract a slightly larger amount to lift lessons content closer to the header */
  --lessons-top-offset: calc(var(--app-header-height) - 20px);
}

.lessons-root { box-sizing: border-box; padding: 10px; padding-top: var(--lessons-top-offset); --bg: #0f0b16; --card: #12101a; --accent: linear-gradient(135deg,#ff4dcb,#3ab7ff); --text: #e6eef8 }

/* header layout: keep back button fixed and make title truncatable */
.lessons-header {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 6px 6px;
    width: 100%;
    box-sizing: border-box;
}
.lessons-header .back { flex: 0 0 auto; }
.lessons-header .back-to-modules{
  background: transparent;
  border: 0;
  color: var(--text);
  font-size: 0.95rem;
  cursor: pointer;
  padding: 4px 6px;
}
.lessons-header h3 {
    flex: 1 1 auto;
    min-width: 0; /* needed for text-overflow inside flex */
    margin: 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    color: var(--text);
}

/* level strip */
.level-strip {
    display: flex;
    gap: 1.2rem;
    align-items: center;
    justify-content: center;
    padding: 1rem 0.25rem;
    box-sizing: border-box;
    overflow-x: auto;
}

.level-btn {
    --size: 5rem; /* scalable size for icons */
    width: var(--size);
    height: var(--size);
    min-width: var(--size);
    border-radius: 50%;
    background-color: transparent;
    border: 0;
    position: relative;
    display: inline-grid;
    place-items: center;
    cursor: pointer;
    transition: transform .18s ease, box-shadow .18s ease;
    -webkit-tap-highlight-color: transparent;
}

.level-btn .lvl-img {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: contain;
    transition: opacity .18s ease, transform .18s ease, filter .18s ease;
    border-radius: 50%;
    pointer-events: none;
}

.level-btn .default-img { opacity: 1; }
.level-btn .active-img { opacity: 0; transform: scale(.98); filter: blur(0); }
.level-btn .locked-img { opacity: 0; }

.level-btn:hover .default-img { opacity: 0; transform: scale(.98); }
.level-btn:hover .active-img {
    opacity: 1;
    transform: scale(1.02);
    filter: drop-shadow(0 6px 10px rgba(58,183,255,0.18)) drop-shadow(0 2px 6px rgba(255,77,203,0.06));
}

.level-btn.active .default-img { opacity: 0; }
.level-btn.active .active-img { opacity: 1; transform: scale(1.02); }

.level-btn.locked .default-img { opacity: 0; }
.level-btn.locked .locked-img {
    opacity: 1;
    filter: grayscale(.2) brightness(.9);
}

/* ensure lesson content doesn't push the header/menu size */
.lesson-card { box-sizing: border-box; }

/* lesson card */
.lesson-card {
    margin-top: 0.2rem;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    padding: 0.2rem;
    border-radius: 12px;
    box-shadow: 0 6px 30px rgba(3,6,15,0.6);
    color: var(--text);
}

.question { font-size: 1.05rem; margin-bottom: .8rem; }

.options { display: grid; gap: .6rem; grid-template-columns: 1fr; }

.option {
    padding: .8rem 1rem;
    border-radius: 10px;
    background: rgba(255,255,255,0.02);
    border: 1px solid rgba(255,255,255,0.04);
    color: var(--text);
    text-align: left;
    cursor: pointer;
    transition: background .18s ease, transform .12s ease, box-shadow .12s ease;
}

.option:hover { transform: translateY(-2%); box-shadow: 0 8px 20px rgba(0,0,0,0.45); }

/* reveal colors */
.option.correct { background: rgba(28,160,0,0.14); border-color: rgba(28,160,0,0.28); box-shadow: 0 6px 18px rgba(28,160,0,0.12); }
.option.wrong { background: rgba(220,20,60,0.12); border-color: rgba(220,20,60,0.28); box-shadow: 0 6px 18px rgba(220,20,60,0.12); }

.lesson-footer { display:flex; gap:1rem; align-items:flex-start; justify-content:space-between; margin-top:1rem; flex-wrap:wrap }
.explanation { flex:1 1 60%; min-width:220px }
.controls { display:flex; gap:.5rem; align-items:center }
.ctrl { padding:.5rem .8rem; border-radius:8px; border:0; background:linear-gradient(90deg,#2b2b3a,#1b1a24); color:var(--text) }

/* ensure level buttons don't show any fallback text/numbers (images only) */
.level-btn { font-size: 0; }
.level-btn .level-number { display: none !important; }
/* keep the visually-hidden label available to assistive tech */
.level-btn .visually-hidden { position: absolute !important; height:1px; width:1px; overflow:hidden; clip:rect(1px,1px,1px,1px); white-space:nowrap }

/* responsive: scale sizes using viewport width when small */
@media (max-width: 600px){
    .level-btn { --size: calc(min(18vw, 64px)); }
    .lesson-card { padding: .8rem; border-radius: 10px }
}

@media (min-width: 601px) and (max-width: 1200px){
    .level-btn { --size: calc(min(10vw, 72px)); }
}

/* New: vertical "treasure map" layout for levels */
.level-map {
    --map-gap: clamp(1rem, 6vw, 3.2rem);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--map-gap);
    box-sizing: border-box;
    width: 100%;
    position: relative;
    /* use the value set by JS in :root if available */
    padding-top: 0;
    padding-bottom: 1rem;
    padding-left: 0.5rem;
    padding-right: 0.5rem;
    margin-top: .25rem;
}

.map-item {
    /* stack node then connector vertically so connectors sit between nodes */
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    width: 100%;
    justify-content: flex-start; /* nodes at top of item */
    position: relative;
}

/* stagger every other node to create a treasure-map path */
.map-item:nth-child(odd) .map-node { transform: translateX(-14%); }
.map-item:nth-child(even) .map-node { transform: translateX(14%); }

.map-node {
    transition: transform .28s cubic-bezier(.2,.9,.15,1), box-shadow .18s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    z-index: 50; /* keep nodes above connector and page content so they're clickable */
}

/* connector: a vertical set of small dots and a thin line between nodes */
.connector {
    width: 36px; /* relative small connector width */
    display:flex;
    flex-direction: column;
    align-items:center;
    gap:6px;
    flex: 0 0 auto;
    z-index: 10; /* below the node */
}

/* ensure connectors are responsive and shrink on small screens */
@media (max-width: 600px){
    .connector { width: 22px }
    .conn-dot { width:6px; height:6px }
}

/* keep existing level-btn sizes but make them scale with variables */
.level-btn { --size: 6.2rem; }

/* remove numeric text if present */
.level-btn .visually-hidden { position: absolute !important; height:1px; width:1px; overflow:hidden; clip:rect(1px,1px,1px,1px); white-space:nowrap }

/* when node is active, lift it slightly and show glow */
.map-node .level-btn:hover, .map-node .level-btn.active {
    transform: scale(1.04);
}

.map-node .level-btn:hover .active-img, .map-node .level-btn.active .active-img {
    opacity: 1;
    transform: scale(1.06);
    filter: drop-shadow(0 10px 18px rgba(58,183,255,0.16)) drop-shadow(0 3px 8px rgba(255,77,203,0.06));
}

/* locked appearance remains the same */
.map-node .level-btn.locked .locked-img { opacity: 1 }

/* keep lesson card spacing below the map */
.lessons-root > .lesson-card { margin-top: 2rem }

/* Modules list styling */
.modules-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap: 1rem;
  align-items: start;
  padding: 0.5rem;
}

.module-card {
  background: transparent;
  border-radius: 12px;
  padding: 0.6rem 0.4rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
  color: var(--text);
}

.module-title {
  font-weight: 700;
  font-size: 1rem;
  margin-bottom: 2px;
  color: var(--text);
}

.module-sub {
  font-size: 0.85rem;
  color: rgba(230,238,248,0.75);
}

.module-btn {
  --size: 6.4rem;
  width: var(--size);
  height: var(--size);
  border-radius: 50%;
  border: 0;
  background: transparent;
  display: grid;
  place-items: center;
  position: relative;
  cursor: pointer;
  transition: transform .18s ease;
}

.module-img {
  position: absolute;
  width: 100%;
  height: 100%;
  object-fit: contain;
  border-radius: 50%;
  transition: opacity .18s ease, transform .18s ease, filter .18s ease;
}

.module-img.default-img { opacity: 1 }
.module-img.active-img { opacity: 0 }

.module-btn:hover .default-img { opacity: 0 }
.module-btn:hover .active-img { opacity: 1; transform: scale(1.04); filter: drop-shadow(0 8px 18px rgba(58,183,255,0.14)); }

/* Ensure modules top view is offset below the fixed menu (reduced extra gap) */
.modules-root{ padding-top: calc(var(--app-header-height, 84px) - 20px) }

/* move top padding to the root lessons container so both modules list and in-module views get consistent offset below the fixed menu */
.lessons-root{ /* keep legacy override but use the unified header variable */ padding-top: calc(var(--app-header-height, 84px) - 20px) }

/* Make elements that can be scrolled into view leave space for the fixed header */
.level-map,
.lesson-card,
.lessons-header,
.modules-grid,
.module-card,
.module-btn {
  scroll-margin-top: calc(var(--app-header-height, 84px) + 8px);
}

/* Loading panel styles */
.loading-panel{ display:flex; flex-direction:column; align-items:center; justify-content:center; gap:.8rem; padding:1.2rem; min-height:40vh }
.loading-text{ color: var(--text); opacity:.9; text-align:center }
.elapsed{ margin-top:.25rem; font-size:.9rem; color: rgba(230,238,248,0.7) }
.cancel-btn{ margin-top:.5rem; padding:.5rem .8rem; border-radius:8px; border:0; background:linear-gradient(90deg,#2b2b3a,#1b1a24); color:var(--text); cursor:pointer }
.spinner{ width:38px; height:38px; border:3px solid rgba(255,255,255,.18); border-top-color:#3ab7ff; border-radius:50%; animation:spin 1s linear infinite }
@keyframes spin{ to{ transform: rotate(360deg) } }

/* Report panel */
.report-root{ margin-top:1rem; padding:1rem; border-radius:12px; background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); box-shadow: 0 6px 30px rgba(3,6,15,0.6); color: var(--text) }
.report-header{ display:flex; align-items:center; justify-content:space-between; gap:.5rem; margin-bottom:.75rem }
.report-score{ color: rgba(230,238,248,0.85) }
.report-list{ display:flex; flex-direction:column; gap:.6rem; max-height:45vh; overflow:auto; padding-right:.25rem }
.report-item{ padding:.6rem .75rem; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background: rgba(255,255,255,0.02) }
.report-item.correct{ border-color: rgba(28,160,0,0.28); box-shadow: inset 0 0 0 1px rgba(28,160,0,0.12) }
.report-item.wrong{ border-color: rgba(220,20,60,0.28); box-shadow: inset 0 0 0 1px rgba(220,20,60,0.12) }
.rep-q{ font-weight: 600; margin-bottom:.25rem }
.rep-a, .rep-c, .rep-e{ font-size:.95rem }
.rep-e{ color: rgba(230,238,248,0.85) }
.report-actions{ margin-top:.8rem; display:flex; gap:.5rem; justify-content:flex-end }

/* Explanation block inside quiz */
.explain-text{ margin-top:.4rem; color: rgba(230,238,248,0.9) }
